<h2 class="page-title">Expedientes</h2>

<div class="filters-container" [formGroup]="form">

  <!-- Código expediente -->
  <mat-form-field appearance="outline">
    <mat-label>Código expediente</mat-label>
    <input matInput formControlName="code">
  </mat-form-field>

  <!-- Título -->
  <mat-form-field appearance="outline">
    <mat-label>Título expediente</mat-label>
    <input matInput formControlName="title">
  </mat-form-field>

  <!-- Estado -->
  <mat-form-field appearance="outline">
    <mat-label>Estado</mat-label>
    <mat-select formControlName="status">
      <mat-option value="">Todos</mat-option>
      <mat-option value="open">Abierto</mat-option>
      <mat-option value="closed">Cerrado</mat-option>
    </mat-select>
  </mat-form-field>

  <!-- Tipo cliente -->
  <mat-form-field appearance="outline">
    <mat-label>Tipo de cliente</mat-label>
    <mat-select formControlName="client_type">
      <mat-option value="all">Todos</mat-option>
      <mat-option value="person">Persona</mat-option>
      <mat-option value="company">Empresa</mat-option>
    </mat-select>
  </mat-form-field>

  <!-- Búsqueda multifiltro -->
  <mat-form-field appearance="outline" class="search-wide">
    <mat-icon matPrefix>search</mat-icon>
    <input
      matInput
      formControlName="client_search"
      placeholder="Nombre, documento, email o teléfono..."
    >
  </mat-form-field>

</div>

<table mat-table [dataSource]="dataSource" class="mat-elevation-z2 dossier-table">

  <!-- Código -->
  <ng-container matColumnDef="code">
    <th mat-header-cell *matHeaderCellDef>Código</th>
    <td mat-cell *matCellDef="let d">
      <a [routerLink]="['/dossiers', d.id]">{{ d.code }}</a>
    </td>
  </ng-container>

  <!-- Título -->
  <ng-container matColumnDef="title">
    <th mat-header-cell *matHeaderCellDef>Título</th>
    <td mat-cell *matCellDef="let d">{{ d.title }}</td>
  </ng-container>

  <!-- Cliente -->
  <ng-container matColumnDef="client">
    <th mat-header-cell *matHeaderCellDef>Cliente</th>
    <td mat-cell *matCellDef="let d">
      {{ getClientName(d.client) }}
    </td>
  </ng-container>

  <!-- Estado -->
  <ng-container matColumnDef="status">
    <th mat-header-cell *matHeaderCellDef>Estado</th>
    <td mat-cell *matCellDef="let d">
      {{ d.status | dossierStatus }}
    </td>
  </ng-container>

  <!-- PVP -->
  <ng-container matColumnDef="pvp">
    <th mat-header-cell *matHeaderCellDef>PVP</th>
    <td mat-cell *matCellDef="let d">
      {{ d.total_pvp | currency:'EUR' }}
    </td>
  </ng-container>

  <!-- Cobrado -->
  <ng-container matColumnDef="paid">
    <th mat-header-cell *matHeaderCellDef>Cobrado</th>
    <td mat-cell *matCellDef="let d">
      {{ d.total_paid | currency:'EUR' }}
    </td>
  </ng-container>

  <!-- Facturado -->
  <ng-container matColumnDef="invoiced">
    <th mat-header-cell *matHeaderCellDef>Facturado</th>
    <td mat-cell *matCellDef="let d">
      {{ d.total_invoiced | currency:'EUR' }}
    </td>
  </ng-container>

  <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
  <tr mat-row *matRowDef="let row; columns: displayedColumns"></tr>

</table>

<mat-paginator
  [pageSize]="10"
  [pageSizeOptions]="[5, 10, 15]"
  showFirstLastButtons>
</mat-paginator>
